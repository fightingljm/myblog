### 如何处理高并发



- 利用缓存，精简请求 (客户端数据库realm，客户端存储)

- 合并压缩（webpack build）

- 静态资源与后端api分到不同服务器、静态资源上传七牛cdn阿里云，就像大学用餐高峰食堂多开几个窗口一样

- 避免高频刷新页面获取数据（做了一个限定，5秒内刷新页面只获取一次列表数据，避免高频刷新带给服务器的压力）

  ```js
  async init() {
        try {
          const store = JSON.parse(util.getStore('hopoActiveInfo'))
          // 避免高频刷新增加服务器压力
          if (store && (new Date() - new Date(store.getTime)) < 5000) {
            this.basicInfo = store
          } else {
            this.basicInfo = await getActiveInfo()
            this.basicInfo.getTime = new Date()
          }
  
          util.setStore(this.basicInfo, 'hopoActiveInfo')
          this.btn.noPeopleAndStart.detail[0].text = `${
            this.basicInfo.directBuyPrice
          } 元直接购买`
          this.computedStatus()
        } catch (error) {
          console.log(error)
        }
      },
  ```

- 设置响应头cache-control和last-modified

  ```js
  app.all('*', function(req, res, next){
    res.set('Cache-Control','public,max-age=5')
    if ((new Date().getTime() - req.headers['if-modified-since'] )< 5000) {
      // 检查时间戳
      res.statusCode = 304
      res.end()
    }
    else {
      var time =(new Date()).getTime().toString()
      res.set('Last-Modified', time)
    }
    next()
  })
  ```